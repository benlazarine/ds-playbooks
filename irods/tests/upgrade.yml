---
- name: test begin IES upgrade
  hosts: ies:!unmanaged_systems
  become: true
  tasks:
    - include_tasks: tasks/test_pkg_installed.yml
      vars:
        pkg: "{{
          'irods-database-plugin-postgres93'
            if inventory_hostname == 'dstesting_ies_centos6_1.dstesting_default' else
          'irods-database-plugin-postgres' }}"
        version: '1.10'

    - include_tasks: tasks/test_pkg_installed.yml
      vars:
        pkg: irods-icat
        version: '4.1.10'


- name: test upgrade resource server package
  hosts: rs:!ies:!unmanaged_systems
  become: true
  tasks:
    - import_tasks: tasks/test_install_resource_pkg.yml


- name: test upgrade plugins
  hosts: irods:!unmanaged_systems
  become: true
  gather_facts: false
  tasks:
    - import_tasks: tasks/test_install_plugins.yml


- import_playbook: restart_all.yml
