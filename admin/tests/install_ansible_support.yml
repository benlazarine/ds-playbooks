---
- name: test install dmidecode required by ansible gather_facts
  hosts: all:!unmanaged_systems
  become: true
  tasks:
    - name: test install dmidcode support for CentOS
      when: ansible_distribution == 'CentOS'
      yum:
        list: dmidecode
      register: result
      failed_when: |
        result.results | selectattr("yumstate", 'equalto', "installed") | list | count != 1

    - name: test install dmicode support for distributions other than CentOS
      when: ansible_distribution != 'CentOS'
      command: dpkg --status dmidecode
      changed_when: false


- name: test install required packages for ansible
  hosts: all:!unmanaged_systems
  become: true
  gather_facts: false
  tasks:
    - name: test install EPEL repo
      when: ansible_distribution == 'CentOS'
      debug:
        msg: TODO implement

    - name: test install packages
      debug:
        msg: TODO implement

    - name: test install systemd on CentOS 7
      when: ansible_distribution == 'CentOS' and ansible_distribution_major_version == '7'
      yum:
        list: systemd
      failed_when: |
        result.results | selectattr("yumstate", 'equalto', "installed") | list | count != 1
