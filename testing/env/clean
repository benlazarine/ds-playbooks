#! /bin/bash


main()
{
  local baseDir=$(dirname $(readlink -f "$0"))
  local cfg="$@"

  if [ -z "$cfg" ]
  then
    printf 'An environment variable include file is needed.\n' >&2
    return 1
  fi

  if ! [[ "$cfg" =~ ^/ ]]
  then
    cfg="$(pwd)"/"$cfg"
  fi

  . "$cfg"

  while read -r repository rest
  do
    docker rmi "$repository"
  done < <(docker images --filter reference="$ENV_NAME"_* | tail --lines +2)
}


main "$*"
