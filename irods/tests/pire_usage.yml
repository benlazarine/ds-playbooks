---
- import_playbook: mk_storage_resources.yml


- name: test Configure IES for PIRE
  hosts: ies
  become: true
  become_user: irods
  run_once: true
  tasks:
    - name: test make PIRE resource hierarchy
      shell: |
        printf -v expHier 'pireRes:passthru\n└── pire'
        actHier=$(ilsresc pireRes)
        [ "$actHier" = "$expHier" ]
      changed_when: false

    - name: test ensure pire group exists
      shell: |
        response=$(iquest "select USER_GROUP_ID where USER_GROUP_NAME = 'pire'")
        ! [[ "$response" =~ ^CAT_NO_ROWS_FOUND ]]
      changed_when: false

    - name: test set the quota for the pire group
      shell: |
        quota=$(iquest \
          '%s' \
          "select QUOTA_LIMIT where QUOTA_USER_NAME = 'pire' and QUOTA_RESC_NAME = 'pireRes'")

        [ "$quota" -eq 5000000 ]
      changed_when: false

    - name: test create project collection
      debug:
        msg: TODO implement
