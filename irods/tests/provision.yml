---
- name: test provision for iRODS
  hosts: irods:!unmanaged_systems
  become: true
  tasks:
    - name: test uuidd rpm is present
      yum:
        list: uuidd
      register: pkg
      failed_when: pkg.results | selectattr("yumstate", "match", "installed") | list | length != 1

    - name: test create service group
      debug:
        msg: TODO implement

    - name: verify that the system user has correct comment
      command: grep --quiet --regexp '^irods:[^:]*:[^:]*:[^:]*:iRODS Administrator:' /etc/passwd
      changed_when: false


- name: test provision additional for IES
  hosts: ies
  become: true
  gather_facts: false
  tasks:
    - name: test ensure pika installed
      command: pip --disable-pip-version-check show pika
      changed_when: false

    - name: test configure linux kernel
      debug:
        msg: TODO implement
