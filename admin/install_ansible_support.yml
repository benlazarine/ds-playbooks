---
- name: install dmidecode required by ansible gather_facts
  hosts: all:!unmanaged_systems
  become: true
  gather_facts: false
  tasks:
    - name: install dmidecode support
      package:
        name: dmidecode
        state: present


- name: install required packages for ansible
  hosts: all:!unmanaged_systems
  become: true
  tasks:
    - name: install packages
      package:
        name: "{{ item }}"
        state: present
      with_items:
        - jq
        - "{{ 'libselinux-python' if ansible_distribution == 'CentOS' else 'python-selinux' }}"
        - "{{ 'pyOpenSSL' if ansible_distribution  == 'CentOS' else 'python-openssl' }}"
        - python-pip
        - python-requests
        - python-virtualenv
