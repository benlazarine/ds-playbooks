---
- name: Prepare for PostgreSQL
  hosts: dbms
  become: true
  roles:
    - role: jtyr.grub_cmdline
      grub_cmdline_add_args:
        - transparent_hugepage=never

  post_tasks:
    - name: Install PostgreSQL yum repo
      yum:
        name: https://download.postgresql.org/pub/repos/yum/9.3/redhat/rhel-6-x86_64/pgdg-centos93-9.3-3.noarch.rpm

    - name: Install PostgreSQL server
      package:
        name: postgresql93-server
  tags:
    - no_testing

- name: Initialize PostgreSQL cluster
  hosts: dbms
  become: true
  become_user: postgres
  gather_facts: false
  tasks:
    - name: Initialize
      command: /usr/pgsql-9.3/bin/initdb --auth ident --lc-collate C --locale en_US.UTF-8 --pgdata /var/lib/pgsql/9.3/data
  tags:
    - no_testing
