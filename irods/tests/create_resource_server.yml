---
- import_playbook: provision.yml


- name: test install resource server package
  hosts: rs:!ies:!unmanaged_systems
  become: true
  tasks:
    - import_tasks: tasks/test_install_resource_pkg.yml

    - import_tasks: tasks/test_install_plugins.yml


- import_playbook: cfg_irods.yml


- name: test bootstrap iRODS start
  hosts: rs
  become: true
  become_user: irods
  tasks:
    - name: test initialize resource server connection to IES
      stat:
        path: /var/lib/irods/.irods/.irodsA
      register: response
      failed_when: not response.stat.exists or response.stat.pw_name != 'irods'

    - import_tasks: tasks/test_irods_running.yml


- import_playbook: mk_storage_resources.yml
