---
- name: test de-usage
  hosts: dstesting_ies_centos6_1.dstesting_default
  become: true
  become_user: irods
  tasks:
    - name: retrieve DE job user information
      command: iadmin lu de_job
      register: user_info
      changed_when: false

    - name: verify user information
      assert:
        that:
          - user_info.stdout != 'No rows found'
          - 'user_info.stdout is search("user_type_name: rodsuser")'
          - 'user_info.stdout is search("user_info: DE job")'

    - name: verify user has empty password
      environment:
        IRODS_USER_NAME: de_job
        IRODS_AUTHENTICATION_FILE: /dev/null
      shell: iinit -e <<< ''
      changed_when: false
